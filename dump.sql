--
-- PostgreSQL database dump
--

-- Dumped from database version 15.1
-- Dumped by pg_dump version 15.3 (Ubuntu 15.3-1.pgdg22.04+1)

-- Started on 2023-06-08 05:06:36 ADT

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

DROP DATABASE postgres;
--
-- TOC entry 3739 (class 1262 OID 5)
-- Name: postgres; Type: DATABASE; Schema: -; Owner: -
--

CREATE DATABASE postgres WITH TEMPLATE = template0 ENCODING = 'UTF8' LOCALE_PROVIDER = libc LOCALE = 'C.UTF-8';


\connect postgres

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 3740 (class 0 OID 0)
-- Dependencies: 3739
-- Name: DATABASE postgres; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON DATABASE postgres IS 'default administrative connection database';


--
-- TOC entry 3741 (class 0 OID 0)
-- Name: postgres; Type: DATABASE PROPERTIES; Schema: -; Owner: -
--

ALTER DATABASE postgres SET "app.settings.jwt_secret" TO 'WFg1nwZUuh8ahDJx8IFVS3Fk/inrdQBJUCsz0tMjxZcKoQy8zsJGo0VozUfkbKKYZNy8AUeNfhSG4egiTw8nxg==';
ALTER DATABASE postgres SET "app.settings.jwt_exp" TO '3600';


\connect postgres

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 13 (class 2615 OID 2200)
-- Name: public; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA public;


--
-- TOC entry 3742 (class 0 OID 0)
-- Dependencies: 13
-- Name: SCHEMA public; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON SCHEMA public IS 'standard public schema';


--
-- TOC entry 507 (class 1255 OID 28684)
-- Name: handle_new_user(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.handle_new_user() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
begin
  insert into public.profiles (id, full_name, avatar_url)
  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
  return new;
end;
$$;


--
-- TOC entry 508 (class 1255 OID 28930)
-- Name: purchaseorder(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.purchaseorder(reqnumber integer) RETURNS text
    LANGUAGE plpgsql
    AS $$

declare
	number int;
  clientID int;
  clientname text;
  date text;
  amount numeric;
  lines text;

BEGIN
  -- SELECT * into number FROM pos925;
  SELECT po_number, client_id, po_date into number, clientID, date FROM pos925 WHERE po_number = reqNumber;
  
  SELECT SUM(line_quantity * line_price) into amount as purchase_order_total
  FROM lines925
  GROUP BY po_number having po_number = reqNumber;

  select  clients925.client_name into clientname
  from pos925
  join clients925 on pos925.client_id = clients925.client_id AND pos925.po_number = reqNumber;

  SELECT ARRAY(SELECT CONCAT('{line_number : ', line_number) || ', ' ||  CONCAT('line_price : ', line_price)  || ', ' || CONCAT('line_quantity : ', line_quantity) || ', ' ||  CONCAT('part_number : ', part_number, '}')
  FROM lines925
  WHERE po_number = reqNumber
  ) into lines;

  if number is null then
    RETURN (text('{error: No Purchase Order Found}'));
  end if;

  RETURN concat(
    'po_number : ', number, ', ',
    'client_name : "',  replace(clientname, '"',''), '", ',
    'date : "', date, '", ',
    'lines : [', replace(lines, '"', ''),
    ']'
    );
END;

$$;


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 275 (class 1259 OID 28834)
-- Name: clients925; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.clients925 (
    client_id bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    client_name text,
    client_city text
);


--
-- TOC entry 276 (class 1259 OID 28837)
-- Name: clients925_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.clients925 ALTER COLUMN client_id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.clients925_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 277 (class 1259 OID 28851)
-- Name: lines925; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.lines925 (
    line_number bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    line_quantity bigint,
    line_price numeric,
    po_number bigint,
    part_number bigint
);


--
-- TOC entry 278 (class 1259 OID 28854)
-- Name: lines007_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.lines925 ALTER COLUMN line_number ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.lines007_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 271 (class 1259 OID 28779)
-- Name: parts925; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.parts925 (
    created_at timestamp with time zone DEFAULT now(),
    part_name text,
    part_number bigint NOT NULL,
    part_description text,
    quantity_on_hand bigint
);


--
-- TOC entry 272 (class 1259 OID 28789)
-- Name: parts925_part_number_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.parts925 ALTER COLUMN part_number ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.parts925_part_number_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 273 (class 1259 OID 28822)
-- Name: pos925; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.pos925 (
    po_number bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    po_date date,
    client_id bigint
);


--
-- TOC entry 274 (class 1259 OID 28825)
-- Name: pos925_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

ALTER TABLE public.pos925 ALTER COLUMN po_number ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.pos925_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 3730 (class 0 OID 28834)
-- Dependencies: 275
-- Data for Name: clients925; Type: TABLE DATA; Schema: public; Owner: -
--

INSERT INTO public.clients925 VALUES (1, '2023-06-07 02:11:34.551568+00', 'Liam', 'Halifax');
INSERT INTO public.clients925 VALUES (2, '2023-06-08 00:45:24.460064+00', 'Jeff', 'Halifax');
INSERT INTO public.clients925 VALUES (8, '2023-06-08 04:12:02.400124+00', 'James', 'Halifax');
INSERT INTO public.clients925 VALUES (9, '2023-06-08 06:32:52.22472+00', 'Tom', 'Halifax');
INSERT INTO public.clients925 VALUES (10, '2023-06-08 07:28:57.656533+00', 'Matt', 'Moncton');


--
-- TOC entry 3732 (class 0 OID 28851)
-- Dependencies: 277
-- Data for Name: lines925; Type: TABLE DATA; Schema: public; Owner: -
--

INSERT INTO public.lines925 VALUES (3, '2023-06-07 05:09:17.360138+00', 3, 398.99, 1, 3);
INSERT INTO public.lines925 VALUES (1, '2023-06-07 05:09:17.36+00', 3, 398.99, 3, 3);
INSERT INTO public.lines925 VALUES (4, '2023-06-08 01:33:53.454542+00', 2, 123.99, 1, 2);
INSERT INTO public.lines925 VALUES (2, '2023-06-08 01:33:53.454+00', 4, 123.99, 3, 2);
INSERT INTO public.lines925 VALUES (11, '2023-06-08 02:39:30.09009+00', 2, 123.99, 2, 2);
INSERT INTO public.lines925 VALUES (12, '2023-06-08 02:39:30.121108+00', 4, 123.99, 2, 2);


--
-- TOC entry 3726 (class 0 OID 28779)
-- Dependencies: 271
-- Data for Name: parts925; Type: TABLE DATA; Schema: public; Owner: -
--

INSERT INTO public.parts925 VALUES ('2023-06-07 00:05:18.183461+00', 'Ryzen Threadripper 2920X', 2, NULL, 3);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:24.93005+00', 'Ryzen Threadripper 2920X', 3, NULL, 3);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:24.963176+00', 'Ryzen 9 7845HX', 4, NULL, 4);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:35.259002+00', 'Intel Xeon Gold 5117 Processor (19.25M Cache, 2.00 GHz)', 18, NULL, 5);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:35.29103+00', 'Intel Xeon Gold 6137 Processor (24.75M Cache, 3.90 GHz)', 19, NULL, 10);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:35.322955+00', 'Intel Xeon Silver 4106H Processor (11M Cache, 1.80 GHz)', 20, NULL, 10);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:35.354994+00', 'Intel Xeon Platinum 8160H Processor (33M Cache, 2.10 GHz)', 21, NULL, 12);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:15:35.388184+00', 'Intel Xeon Platinum 8176M Processor (38.5M Cache, 2.10 GHz)', 22, NULL, 12);
INSERT INTO public.parts925 VALUES ('2023-06-07 04:03:34.16826+00', 'Core i9-13900k', 25, NULL, 2);
INSERT INTO public.parts925 VALUES ('2023-06-07 00:00:51.664569+00', 'Core i9-13900k', 1, NULL, 2);
INSERT INTO public.parts925 VALUES ('2023-06-07 18:09:38.338057+00', 'Pentium 4', 26, 'Test', NULL);


--
-- TOC entry 3728 (class 0 OID 28822)
-- Dependencies: 273
-- Data for Name: pos925; Type: TABLE DATA; Schema: public; Owner: -
--

INSERT INTO public.pos925 VALUES (2, '2023-06-07 04:18:42.497946+00', '2023-06-05', 1);
INSERT INTO public.pos925 VALUES (3, '2023-06-07 04:19:07.319238+00', '2023-06-05', 1);
INSERT INTO public.pos925 VALUES (4, '2023-06-07 04:19:12.49511+00', '2023-06-05', 2);
INSERT INTO public.pos925 VALUES (1, '2023-06-07 05:04:29.427181+00', '2023-06-07', 2);


--
-- TOC entry 3743 (class 0 OID 0)
-- Dependencies: 276
-- Name: clients925_id_seq; Type: SEQUENCE SET; Schema: public; Owner: -
--

SELECT pg_catalog.setval('public.clients925_id_seq', 10, true);


--
-- TOC entry 3744 (class 0 OID 0)
-- Dependencies: 278
-- Name: lines007_id_seq; Type: SEQUENCE SET; Schema: public; Owner: -
--

SELECT pg_catalog.setval('public.lines007_id_seq', 12, true);


--
-- TOC entry 3745 (class 0 OID 0)
-- Dependencies: 272
-- Name: parts925_part_number_seq; Type: SEQUENCE SET; Schema: public; Owner: -
--

SELECT pg_catalog.setval('public.parts925_part_number_seq', 30, true);


--
-- TOC entry 3746 (class 0 OID 0)
-- Dependencies: 274
-- Name: pos925_id_seq; Type: SEQUENCE SET; Schema: public; Owner: -
--

SELECT pg_catalog.setval('public.pos925_id_seq', 13, true);


--
-- TOC entry 3567 (class 2606 OID 28870)
-- Name: clients925 clients925_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.clients925
    ADD CONSTRAINT clients925_pkey PRIMARY KEY (client_id);


--
-- TOC entry 3569 (class 2606 OID 28877)
-- Name: lines925 lines007_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lines925
    ADD CONSTRAINT lines007_pkey PRIMARY KEY (line_number);


--
-- TOC entry 3561 (class 2606 OID 28791)
-- Name: parts925 parts925_part_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.parts925
    ADD CONSTRAINT parts925_part_number_key UNIQUE (part_number);


--
-- TOC entry 3563 (class 2606 OID 28816)
-- Name: parts925 parts925_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.parts925
    ADD CONSTRAINT parts925_pkey PRIMARY KEY (part_number);


--
-- TOC entry 3565 (class 2606 OID 28879)
-- Name: pos925 pos925_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pos925
    ADD CONSTRAINT pos925_pkey PRIMARY KEY (po_number);


--
-- TOC entry 3571 (class 2606 OID 28915)
-- Name: lines925 lines925_part_number_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lines925
    ADD CONSTRAINT lines925_part_number_fkey FOREIGN KEY (part_number) REFERENCES public.parts925(part_number);


--
-- TOC entry 3572 (class 2606 OID 28910)
-- Name: lines925 lines925_po_number_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lines925
    ADD CONSTRAINT lines925_po_number_fkey FOREIGN KEY (po_number) REFERENCES public.pos925(po_number);


--
-- TOC entry 3570 (class 2606 OID 28895)
-- Name: pos925 pos925_client_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.pos925
    ADD CONSTRAINT pos925_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients925(client_id);


--
-- TOC entry 3723 (class 0 OID 28834)
-- Dependencies: 275
-- Name: clients925; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.clients925 ENABLE ROW LEVEL SECURITY;

--
-- TOC entry 3724 (class 0 OID 28851)
-- Dependencies: 277
-- Name: lines925; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.lines925 ENABLE ROW LEVEL SECURITY;

--
-- TOC entry 3722 (class 0 OID 28822)
-- Dependencies: 273
-- Name: pos925; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.pos925 ENABLE ROW LEVEL SECURITY;

-- Completed on 2023-06-08 05:06:39 ADT

--
-- PostgreSQL database dump complete
--

